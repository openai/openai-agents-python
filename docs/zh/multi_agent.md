---
search:
  exclude: true
---
# 编排多个智能体

编排指的是你在应用中安排智能体的运行流程：哪些智能体运行、以什么顺序运行、以及它们如何决定下一步。编排智能体主要有两种方式：

1. 让 LLM 做决策：利用 LLM 的智能进行规划、推理，并据此决定要采取的步骤。
2. 通过代码编排：用代码确定智能体的运行流程。

你可以将这些模式混合使用。每种方式都有各自的权衡，详述如下。

## 通过 LLM 编排

智能体是一个配备了指令、工具和 任务转移 的 LLM。这意味着面对开放式任务时，LLM 可以自主规划如何处理任务，使用工具执行操作和获取数据，并通过 任务转移 将子任务委托给子智能体。比如，一个研究智能体可以配备如下工具：

- 网络检索以在线查找信息
- 文件检索与内容提取以搜索专有数据与连接
- 计算机操作 以在计算机上执行操作
- 代码执行 以进行数据分析
- 任务转移 至擅长规划、报告撰写等的专业智能体

当任务是开放式且你希望依赖 LLM 的智能时，这种模式非常合适。这里最重要的策略包括：

1. 投入打磨高质量的提示词。明确可用的工具、如何使用，以及必须遵守的参数范围。
2. 监控你的应用并持续迭代。观察问题出现的地方，并迭代你的提示词。
3. 允许智能体自省与改进。例如，将其在循环中运行，让其自我批评；或提供错误信息并让其改进。
4. 采用在单一任务上表现卓越的专业智能体，而不是期望一个通用智能体在所有方面都很优秀。
5. 投入[评测（evals）](https://platform.openai.com/docs/guides/evals)。这能帮助你训练智能体以改进并更好地完成任务。

## 通过代码编排

虽然通过 LLM 编排功能强大，但通过代码编排可以在速度、成本和性能方面让任务更具确定性和可预期。常见模式包括：

- 使用 [structured outputs](https://platform.openai.com/docs/guides/structured-outputs) 生成可由你的代码检查的 格式良好的数据。比如，你可以让智能体将任务归类到若干目录，然后基于该目录选择下一个智能体。
- 将多个智能体串联使用，把一个的输出转换为下一个的输入。你可以将撰写博客文章这样的任务分解为一系列步骤 - 做研究、写大纲、写正文、批判性审阅，然后改进。
- 在 `while` 循环中运行执行任务的智能体与负责评估和反馈的智能体，直到评估者认为输出通过特定标准。
- 并行运行多个智能体，例如通过 Python 的基本组件 `asyncio.gather`。当你有多个彼此无依赖的任务时，这对提升速度很有用。

我们在 [`examples/agent_patterns`](https://github.com/openai/openai-agents-python/tree/main/examples/agent_patterns) 中提供了多种代码示例。