---
search:
  exclude: true
---
# 编排多个智能体

编排指的是应用中智能体的流程：哪些智能体运行、以何种顺序运行，以及它们如何决定接下来发生什么。有两种主要的编排方式：

1. 让 LLM 决策：利用 LLM 的智能进行规划、推理，并据此决定采取的步骤。
2. 通过代码编排：用你的代码来决定智能体的流程。

你可以混合使用这些模式。每种模式都有取舍，详见下文。

## 通过 LLM 编排

智能体是配备了指令、工具和任务转移的 LLM。这意味着面对一个开放式任务，LLM 可以自主规划如何完成任务，使用工具执行操作并获取数据，并通过任务转移将工作委派给子智能体。比如，一个研究类智能体可以配备如下工具：

- 网络检索以在线查找信息
- 文件检索与提取以搜索专有数据及连接
- 计算机操作以在计算机上执行操作
- 代码执行以进行数据分析
- 任务转移到擅长规划、报告撰写等工作的专业智能体

当任务是开放式且希望依赖 LLM 智能时，这种模式非常适合。关键做法包括：

1. 打磨高质量提示词。明确可用的工具、如何使用它们，以及必须遵守的参数范围。
2. 监控应用并迭代改进。找出问题所在，并迭代优化你的提示词。
3. 允许智能体自我反思与改进。例如，让其在循环中运行并自我批判；或提供错误信息并让其改进。
4. 使用在单一任务上表现出色的专用智能体，而非期望一个通用智能体在所有方面都很强。
5. 投入于[评测（evals）](https://platform.openai.com/docs/guides/evals)。这有助于训练你的智能体，提升其任务能力。

## 通过代码编排

尽管通过 LLM 编排很强大，但通过代码编排可以在速度、成本和性能方面让任务更具确定性和可预测性。常见模式包括：

- 使用[structured outputs](https://platform.openai.com/docs/guides/structured-outputs)生成你可以用代码检查的格式良好的数据。例如，你可以让智能体将任务归类为若干目录，然后基于该目录选择下一个智能体。
- 将多个智能体串联起来，把一个的输出转化为下一个的输入。你可以将撰写博客文章的任务分解为一系列步骤——做研究、写大纲、写正文、批判性审阅、再改进。
- 让执行任务的智能体与一个评估并提供反馈的智能体一起在 `while` 循环中运行，直到评估者认为输出通过特定标准为止。
- 并行运行多个智能体，例如通过 Python 基本组件如 `asyncio.gather`。当你有彼此独立的多个任务时，这有助于提速。

我们在[`examples/agent_patterns`](https://github.com/openai/openai-agents-python/tree/main/examples/agent_patterns)中提供了若干 code examples。